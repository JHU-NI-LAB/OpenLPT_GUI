name: Sync to Lab Repository

on:
  push:
    branches:
      - main

jobs:
  repo-sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false # ！！！必须加这一行，防止系统凭据干扰

      - name: Push to Lab Repo
        env:
          MY_TOKEN: ${{ secrets.LAB_REPO_TOKEN }}
        run: |
          # 清除可能存在的旧远程
          git remote remove lab 2>/dev/null || true
          
          # 直接把 Token 拼在推送到地址里
          git push https://x-access-token:${MY_TOKEN}@github.com/JHU-NI-LAB/OpenLPT_GUI.git main:main --force